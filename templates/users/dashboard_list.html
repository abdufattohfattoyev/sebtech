{% extends 'base.html' %}
{% block page_title %}Foydalanuvchilar{% endblock %}

{% block extra_css %}
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

/* Stats */
.stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
.stat-card { background: white; padding: 1.25rem; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
.stat-value { font-size: 2rem; font-weight: 700; color: #111827; }
.stat-label { font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem; }

/* Table */
.table-card { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); overflow: hidden; }
.table-header { padding: 1.25rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }
.table-title { font-size: 1.125rem; font-weight: 700; color: #111827; }
.btn-add { background: #2563eb; color: white; padding: 0.625rem 1.25rem; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 0.875rem; }
.btn-add:hover { background: #1d4ed8; color: white; }

.users-table { width: 100%; border-collapse: collapse; }
.users-table th { background: #f9fafb; padding: 0.875rem 1.25rem; text-align: left; font-weight: 600; color: #374151; font-size: 0.875rem; border-bottom: 1px solid #e5e7eb; }
.users-table td { padding: 0.875rem 1.25rem; border-bottom: 1px solid #f3f4f6; }
.users-table tr:hover { background: #f9fafb; }

.user-info { display: flex; align-items: center; gap: 0.75rem; }
.user-avatar { width: 40px; height: 40px; border-radius: 50%; background: #3b82f6; color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.875rem; }
.user-name { font-weight: 600; color: #111827; }
.user-username { font-size: 0.875rem; color: #6b7280; }

.badge { padding: 0.375rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600; }
.badge-role { background: #e5e7eb; color: #374151; }
.badge-active { background: #dcfce7; color: #166534; }
.badge-inactive { background: #fee2e2; color: #991b1b; }

.btn-actions { display: flex; gap: 0.5rem; }
.btn-action { width: 32px; height: 32px; border-radius: 6px; border: none; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 0.875rem; cursor: pointer; }
.btn-view { background: #3b82f6; color: white; }
.btn-edit { background: #f59e0b; color: white; }
.btn-delete { background: #ef4444; color: white; }
.btn-stats { background: #10b981; color: white; }

/* Mobile Cards */
.user-cards { display: none; padding: 1rem; }
.user-card { background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
.card-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem; }
.card-details { display: flex; gap: 0.5rem; flex-wrap: wrap; }
.card-actions { display: flex; gap: 0.5rem; margin-top: 0.75rem; }

.empty { text-align: center; padding: 3rem; color: #9ca3af; }

/* Pagination */
.pagination { display: flex; justify-content: center; gap: 0.5rem; padding: 1.25rem; }
.page-btn { padding: 0.5rem 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; background: white; color: #374151; text-decoration: none; font-size: 0.875rem; }
.page-btn:hover { background: #f3f4f6; color: #111827; }
.page-btn.active { background: #2563eb; border-color: #2563eb; color: white; }

/* Responsive */
@media (max-width: 1024px) {
    .stats { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 768px) {
    .stats { grid-template-columns: 1fr; gap: 0.75rem; }
    .stat-card { padding: 1rem; }
    .stat-value { font-size: 1.5rem; }
    .table-header { flex-direction: column; gap: 1rem; align-items: stretch; }
    .users-table { display: none; }
    .user-cards { display: block; }
}
</style>
{% endblock %}

{% block content %}
<div>
    {% if stats %}
    <!-- Stats -->
    <div class="stats">
        <div class="stat-card">
            <div class="stat-value">{{ stats.total }}</div>
            <div class="stat-label">Jami</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.active }}</div>
            <div class="stat-label">Faol</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.seller }}</div>
            <div class="stat-label">Sotuvchi</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.boss }}</div>
            <div class="stat-label">Rahbar</div>
        </div>
    </div>

    <!-- Table -->
    <div class="table-card">
        <div class="table-header">
            <div class="table-title">Foydalanuvchilar</div>
            <a href="{% url 'users:user_create' %}" class="btn-add">+ Yangi</a>
        </div>

        {% if page_obj %}
        <!-- Desktop Table -->
        <table class="users-table">
            <thead>
                <tr>
                    <th>Foydalanuvchi</th>
                    <th>Telefon</th>
                    <th>Rol</th>
                    <th>Holat</th>
                    <th>Amallar</th>
                </tr>
            </thead>
            <tbody>
                {% for profile in page_obj %}
                <tr>
                    <td>
                        <div class="user-info">
                            <div class="user-avatar">{{ profile.user.first_name.0|default:profile.user.username.0|upper }}</div>
                            <div>
                                <div class="user-name">{{ profile.user.get_full_name|default:profile.user.username }}</div>
                                <div class="user-username">@{{ profile.user.username }}</div>
                            </div>
                        </div>
                    </td>
                    <td>{{ profile.phone_number|default:"—" }}</td>
                    <td><span class="badge badge-role">{{ profile.get_role_display }}</span></td>
                    <td>
                        {% if profile.user.is_active %}
                        <span class="badge badge-active">Faol</span>
                        {% else %}
                        <span class="badge badge-inactive">Nofaol</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="btn-actions">
                            <a href="{% url 'users:user_detail' profile.pk %}" class="btn-action btn-view"><i class="fas fa-eye"></i></a>
                            {% if profile.role == 'seller' %}
                            <a href="{% url 'users:seller_statistics' profile.pk %}" class="btn-action btn-stats"><i class="fas fa-chart-bar"></i></a>
                            {% endif %}
                            <a href="{% url 'users:user_edit' profile.pk %}" class="btn-action btn-edit"><i class="fas fa-edit"></i></a>
                            <a href="{% url 'users:user_delete' profile.pk %}" class="btn-action btn-delete" onclick="return confirm('O\'chirmoqchimisiz?')"><i class="fas fa-trash"></i></a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Mobile Cards -->
        <div class="user-cards">
            {% for profile in page_obj %}
            <div class="user-card">
                <div class="card-header">
                    <div class="user-info">
                        <div class="user-avatar">{{ profile.user.first_name.0|default:profile.user.username.0|upper }}</div>
                        <div>
                            <div class="user-name">{{ profile.user.get_full_name|default:profile.user.username }}</div>
                            <div class="user-username">@{{ profile.user.username }}</div>
                        </div>
                    </div>
                </div>
                <div class="card-details">
                    <span class="badge badge-role">{{ profile.get_role_display }}</span>
                    {% if profile.user.is_active %}
                    <span class="badge badge-active">Faol</span>
                    {% else %}
                    <span class="badge badge-inactive">Nofaol</span>
                    {% endif %}
                    {% if profile.phone_number %}
                    <small>{{ profile.phone_number }}</small>
                    {% endif %}
                </div>
                <div class="card-actions">
                    <a href="{% url 'users:user_detail' profile.pk %}" class="btn-action btn-view"><i class="fas fa-eye"></i></a>
                    {% if profile.role == 'seller' %}
                    <a href="{% url 'users:seller_statistics' profile.pk %}" class="btn-action btn-stats"><i class="fas fa-chart-bar"></i></a>
                    {% endif %}
                    <a href="{% url 'users:user_edit' profile.pk %}" class="btn-action btn-edit"><i class="fas fa-edit"></i></a>
                    <a href="{% url 'users:user_delete' profile.pk %}" class="btn-action btn-delete" onclick="return confirm('O\'chirmoqchimisiz?')"><i class="fas fa-trash"></i></a>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <div class="pagination">
            {% if page_obj.has_previous %}
            <a class="page-btn" href="?page=1">«</a>
            <a class="page-btn" href="?page={{ page_obj.previous_page_number }}">‹</a>
            {% endif %}
            <span class="page-btn active">{{ page_obj.number }}</span>
            {% if page_obj.has_next %}
            <a class="page-btn" href="?page={{ page_obj.next_page_number }}">›</a>
            <a class="page-btn" href="?page={{ page_obj.paginator.num_pages }}">»</a>
            {% endif %}
        </div>
        {% endif %}
        {% else %}
        <div class="empty">Foydalanuvchilar yo'q</div>
        {% endif %}
    </div>
    {% else %}
    <div class="empty">Sizda ruxsat yo'q</div>
    {% endif %}
</div>
{% endblock %}